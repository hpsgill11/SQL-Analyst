SELECT
    -- wm.orders.order_type as Order_Type,
    -- wm.task_dtl.INVN_TYPE as Inventory_Type,
    wm.task_dtl.TC_ORDER_ID,
        CASE 
        WHEN wm.orders.TOTAL_NBR_OF_UNITS = 1 THEN 'Single'
        ELSE 'Multi'
    END AS Order_Type,
    CASE 
        WHEN wm.task_hdr.STAT_CODE = 5 AND wm.lpn.lpn_facility_status = '10' THEN 'Pending FA'
        WHEN wm.task_hdr.STAT_CODE = 10 AND wm.lpn.lpn_facility_status = '10' AND wm.task_dtl.MISC_ALPHA_FIELD_2 IS NULL THEN 'Ready To Carton Start'
        WHEN wm.task_hdr.STAT_CODE = 10 OR wm.task_hdr.STAT_CODE = 30 AND wm.lpn.lpn_facility_status = '10' AND wm.task_dtl.MISC_ALPHA_FIELD_2 IS NOT NULL THEN 'Carton Started'
        WHEN wm.task_hdr.STAT_CODE = 99 AND wm.lpn.lpn_facility_status = '10' THEN 'Pick Complete'
        WHEN wm.lpn.lpn_facility_status = '99' THEN 'Shorted'
        WHEN wm.lpn.lpn_facility_status = '15' THEN 'In Packing'
        WHEN wm.lpn.lpn_facility_status = '20' THEN 'Packed'
        WHEN wm.lpn.lpn_facility_status = '30' THEN 'Weighed'
        WHEN wm.lpn.lpn_facility_status = '50' THEN 'Loaded'
        WHEN wm.lpn.lpn_facility_status = '90' THEN 'Shipped'
    END AS Pick_Status,
    CASE 
        WHEN wm.lpn.lpn_facility_status = 99 THEN wm.task_dtl.QTY_ALLOC
        ELSE NULL
    END AS Shorted,
    -- wm.orders.Order_date_dttm as Order_Date,
    -- wm.orders.created_dttm as Created_Date_Time,
    TO_CHAR(wm.orders.created_dttm, 'YYYY/MM/DD') as Order_Create_Date,
    CASE wm.orders.DO_STATUS
    WHEN 100 THEN 'Draft'
    WHEN 110 THEN 'Released'
    WHEN 120 THEN 'PDCA'
    WHEN 130 THEN 'DC Allocated'
    WHEN 140 THEN 'In Packing'
    WHEN 150 THEN 'Packed'
    WHEN 160 THEN 'Weighed'
    WHEN 165 THEN 'Staged'
    WHEN 180 THEN 'Loaded'
    WHEN 190 THEN 'Shipped'
    WHEN 200 THEN 'Cancelled'
    ELSE TO_CHAR(wm.orders.DO_STATUS)
    END AS Order_Status,
    wm.orders.RTE_TYPE_1 AS LANE_NAME,
    wm.orders.ref_field_1,
    wm.task_dtl.task_Id as Task_ID,
    CASE wm.task_hdr.STAT_CODE
        WHEN 5 THEN 'Locked Disabled'
        WHEN 10 THEN 'Released'
        WHEN 30 THEN 'Assigned'
        WHEN 99 THEN 'Cancelled'
        ELSE TO_CHAR(wm.task_hdr.STAT_CODE)
    END AS Task_Header_Status,
    wm.task_hdr.TASK_DESC,
        CASE 
        WHEN (wm.task_hdr.STAT_CODE IN (5, 10) AND (wm.task_dtl.MISC_ALPHA_FIELD_2 IS NULL OR wm.task_dtl.MISC_ALPHA_FIELD_2 = '')) THEN 'Ready to Induct'
        ELSE wm.task_dtl.MISC_ALPHA_FIELD_2
        END AS Tote_Number,
    wm.task_dtl.TASK_GENRTN_REF_NBR as Wave_Number,
    wm.wave_parm.wave_desc,
    wm.locn_hdr.DSP_LOCN AS Location,
    wm.task_dtl.PIKR_NBR as Zone,
    wm.task_dtl.TASK_CMPL_REF_NBR as oLPN,
        CASE  wm.lpn.lpn_facility_status
        WHEN 10 THEN 'Printed'
        WHEN 12 THEN 'Released'
        WHEN 15 THEN 'In Packing'
        WHEN 20 THEN 'Packed'  
        WHEN 30 THEN 'Weighed'
        WHEN 40 THEN 'Manifested'
        WHEN 50 THEN 'Loaded on truck'
        WHEN 89 THEN 'Completed VAS'
        WHEN 90 THEN 'Shipped'
        WHEN 99 THEN 'Cancelled'
        ELSE  TO_CHAR(wm.lpn.lpn_facility_status)
    END AS oLPN_Status,
    wm.task_dtl.QTY_ALLOC as Allocated_Quantity,
    wm.lpn.TRACKING_NBR,
    wm.lpn.TC_parent_LPN_id as Pallet_ID,
    wm.lpn.TC_shipment_id as Shipment_ID,
    WM.item_cbo.ITEM_NAME,
    WM.item_cbo.DESCRIPTION 
FROM wm.orders
JOIN wm.task_dtl ON wm.orders.TC_ORDER_ID = wm.task_dtl.TC_ORDER_ID
JOIN wm.task_hdr ON wm.task_dtl.Task_ID = wm.task_hdr.TASK_ID
JOIN wm.locn_hdr ON wm.task_dtl.PULL_LOCN_ID = wm.locn_hdr.LOCN_ID
JOIN wm.item_cbo ON wm.task_dtl.ITEM_ID = wm.item_cbo.ITEM_ID
JOIN wm.lpn ON wm.lpn.TC_LPN_ID = wm.task_dtl.TASK_CMPL_REF_NBR
JOIN wm.wave_parm ON wm.wave_parm.wave_nbr = wm.task_dtl.TASK_GENRTN_REF_NBR
WHERE 
--wm.orders.DO_STATUS IN (130, 140)
wm.orders.order_type = 'ECOMM' 
AND wm.task_hdr.pick_to_tote_flag = 'Y' 
and wm.task_dtl.INVN_TYPE = 'E'
AND wm.task_dtl.CURR_WORK_GRP = 'SHLF'
AND wm.orders.DO_STATUS != '200'
AND wm.orders.DO_STATUS != '190'

-- Testing
-- AND wm.lpn.lpn_facility_status = '20'
-- AND wm.task_hdr.STAT_CODE = '30'
-- AND TRUNC(wm.orders.created_dttm) = TO_DATE('2024-05-14', 'YYYY-MM-DD')
