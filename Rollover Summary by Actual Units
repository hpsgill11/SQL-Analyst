SELECT *
FROM (
    SELECT
        TO_CHAR(wm.orders.created_dttm, 'YYYY/MM/DD') as Order_Create_Date,
        CASE 
            WHEN wm.orders.TOTAL_NBR_OF_UNITS = 1 THEN 'Single'
            ELSE 'Multi'
        END AS Order_Type,
    CASE 
        WHEN wm.task_hdr.STAT_CODE = 5 AND wm.lpn.lpn_facility_status = '10' THEN 'Pending FA'
        WHEN wm.task_hdr.STAT_CODE = 10 AND wm.lpn.lpn_facility_status = '10' AND wm.task_dtl.MISC_ALPHA_FIELD_2 IS NULL THEN 'Ready To Carton Start'
        WHEN wm.task_hdr.STAT_CODE = 10 OR wm.task_hdr.STAT_CODE = 30 AND wm.lpn.lpn_facility_status = '10' AND wm.task_dtl.MISC_ALPHA_FIELD_2 IS NOT NULL THEN 'Carton Started'
        WHEN wm.task_hdr.STAT_CODE = 99 AND wm.lpn.lpn_facility_status = '10' THEN 'Pick Complete'
        WHEN wm.lpn.lpn_facility_status = '99' THEN 'Shorted'
        WHEN wm.lpn.lpn_facility_status = '15' THEN 'In Packing'
        WHEN wm.lpn.lpn_facility_status = '20' THEN 'Packed'
        WHEN wm.lpn.lpn_facility_status = '30' THEN 'Weighed'
        WHEN wm.lpn.lpn_facility_status = '50' THEN 'Loaded'
        WHEN wm.lpn.lpn_facility_status = '90' THEN 'Shipped'
    END AS Pick_Status,
        wm.task_dtl.QTY_ALLOC
    FROM wm.orders
    JOIN wm.task_dtl ON wm.orders.TC_ORDER_ID = wm.task_dtl.TC_ORDER_ID
    JOIN wm.task_hdr ON wm.task_dtl.Task_ID = wm.task_hdr.TASK_ID
    JOIN wm.locn_hdr ON wm.task_dtl.PULL_LOCN_ID = wm.locn_hdr.LOCN_ID
    JOIN wm.item_cbo ON wm.task_dtl.ITEM_ID = wm.item_cbo.ITEM_ID
    JOIN wm.lpn ON wm.lpn.TC_LPN_ID = wm.task_dtl.TASK_CMPL_REF_NBR
    JOIN wm.wave_parm ON wm.wave_parm.wave_nbr = wm.task_dtl.TASK_GENRTN_REF_NBR
    WHERE 
        -- wm.orders.DO_STATUS IN (130, 140)
        wm.orders.order_type = 'ECOMM' 
        -- AND wm.task_hdr.pick_to_tote_flag = 'Y' 
        AND wm.task_dtl.INVN_TYPE = 'E'
        AND wm.task_dtl.CURR_WORK_GRP = 'SHLF'
        AND wm.orders.DO_STATUS != '200'
        AND wm.orders.DO_STATUS != '190'
        -- AND wm.lpn.lpn_facility_status = '10'
        -- AND TRUNC(wm.orders.created_dttm) = TO_DATE('2024-05-14', 'YYYY-MM-DD')
)
PIVOT (
    SUM(QTY_ALLOC) FOR Pick_Status IN (
        'Pending FA' AS Pending_FA,
        'Ready To Carton Start' AS Ready_To_Carton_Start,
        'Carton Started' AS Carton_Started,
        'Pick Complete' AS Pick_Complete,
        'In Packing' AS In_Packing,
        'Packed' AS Packed,
        'Weighed' AS Weighed,
        'Loaded' AS Loaded_on_Truck
    )
)
ORDER BY Order_Create_Date, Order_Type DESC;
