SELECT
    TO_CHAR(wm.orders.created_dttm, 'YYYY/MM/DD') as Order_Create_Date_PST,
    TO_CHAR(wm.orders.created_dttm + INTERVAL '3' HOUR, 'YYYY/MM/DD') AS Order_Create_Date_EST,
    task_dtl.tc_order_id AS Order_ID,
    CASE 
        WHEN wm.orders.TOTAL_NBR_OF_UNITS = 1 THEN 'Single'
    ELSE 'Multi'
    END AS Order_Type,
    do_status.description AS Order_Status,
    CASE 
        WHEN wm.task_hdr.STAT_CODE = 5 AND wm.lpn.lpn_facility_status = '10' THEN 'Pending FA'
        WHEN wm.task_hdr.STAT_CODE = 10 AND wm.lpn.lpn_facility_status = '10' AND wm.task_dtl.MISC_ALPHA_FIELD_2 IS NULL THEN 'Ready To Carton Start'
        WHEN wm.task_hdr.STAT_CODE = 10 OR wm.task_hdr.STAT_CODE = 30 AND wm.lpn.lpn_facility_status = '10' AND wm.task_dtl.MISC_ALPHA_FIELD_2 IS NOT NULL THEN 'Carton Started'
        WHEN wm.task_hdr.STAT_CODE = 99 AND wm.lpn.lpn_facility_status = '10' THEN 'Units to Pack'
        WHEN wm.lpn.lpn_facility_status = '99' THEN 'Shorted'
        WHEN wm.lpn.lpn_facility_status = '15' THEN 'In Packing'
        WHEN wm.lpn.lpn_facility_status = '20' THEN 'Packed'
        WHEN wm.lpn.lpn_facility_status = '30' THEN 'Weighed'
        WHEN wm.lpn.lpn_facility_status = '50' THEN 'Loaded'
        WHEN wm.lpn.lpn_facility_status = '90' THEN 'Shipped'
    END AS Pick_and_Pack_Status,
    wm.task_dtl.INVN_TYPE,
    wm.orders.RTE_TYPE_1 AS LANE_NAME,
    wm.orders.ref_field_1,
    task_dtl.task_type,
    CASE wm.task_hdr.STAT_CODE
        WHEN 5 THEN 'Locked Disabled'
        WHEN 10 THEN 'Released'
        WHEN 30 THEN 'Assigned'
        WHEN 99 THEN 'Cancelled'
    ELSE TO_CHAR(wm.task_hdr.STAT_CODE)
    END AS Task_Header_Status,
    task_dtl.task_id,
    task_hdr.task_desc AS Tote_Type,
    CASE 
        WHEN (wm.task_hdr.STAT_CODE IN (5, 10) AND (wm.task_dtl.MISC_ALPHA_FIELD_2 IS NULL OR wm.task_dtl.MISC_ALPHA_FIELD_2 = '')) THEN 'Ready to Induct'
        ELSE wm.task_dtl.MISC_ALPHA_FIELD_2
    END AS Tote_Number,
    locn_hdr.dsp_locn AS pull_locn,
    task_dtl.pikr_nbr AS Zone,
    item_cbo.item_name AS sku,
    item_cbo.description AS item_desc,
    task_dtl.carton_nbr AS oLPN,
    lpn_facility_status.description AS oLPN_Status,
    task_dtl.TASK_GENRTN_REF_NBR AS Wave_Number,
    wm.wave_parm.wave_desc,
    task_dtl_2.task_id AS cart_task_ID,
    task_dtl_2.TASK_GENRTN_REF_NBR AS Cart_Number,
    task_dtl.qty_alloc AS qty_allocated,
    task_dtl_2.qty_pulld AS qty_picked,
    NVL(picking_short_item.short_qty, 0) AS qty_shorted,
    CASE 
        WHEN task_dtl_2.stat_code = '99' THEN 'Pick Canceled/Shorted'
        WHEN task_dtl_2.stat_code = '90' THEN 'Pick Complete'
        WHEN task_dtl.qty_alloc = 0 THEN 'Canceled/Deleted'
        ELSE 'Pick Incomplete'
    END AS pick_status,
    NVL(alloc_invn_dtl_2.qty_pulld, 0) AS Qty_Put,
    NVL(alloc_invn_dtl_2.qty_alloc, 0) AS Qty_To_Be_Put,
    CASE 
        WHEN alloc_invn_dtl_2.stat_code = '90' THEN 'Put Complete'
        WHEN alloc_invn_dtl_2.stat_code = '99' OR (alloc_invn_dtl_2.stat_code IS NULL AND picking_short_item.short_qty IS NOT NULL) THEN 'Put Canceled'
        WHEN alloc_invn_dtl_2.stat_code = '91' OR alloc_invn_dtl_2.stat_code IS NULL THEN 'Not Applicable'
        ELSE 'Put Incomplete'
    END AS Put_Status,
    wm.lpn.TRACKING_NBR,
    wm.lpn.TC_parent_LPN_id as Pallet_ID,
    wm.lpn.TC_shipment_id as Shipment_ID,
    CASE 
        WHEN ifm.pick_locn_assign_type = 'P09' THEN 'Footwear'
        ELSE 'Non Footwear'
    END AS Footwear_Indicator,
     wm.item_cbo.REF_FIELD2,
    wm.item_cbo.REF_FIELD3,
    wm.item_cbo.item_style,
    wm.item_cbo.Unit_Volume
FROM wm.task_hdr
JOIN wm.task_dtl ON task_dtl.task_id = task_hdr.task_id
JOIN wm.item_cbo ON task_dtl.item_id = item_cbo.item_id
JOIN WM.item_facility_mapping_wms ifm ON ifm.item_id = task_dtl.item_id
JOIN wm.alloc_invn_dtl ON alloc_invn_dtl.alloc_invn_dtl_id = task_dtl.alloc_invn_dtl_id
JOIN wm.locn_hdr ON locn_hdr.locn_id = task_dtl.pull_locn_id
JOIN wm.orders ON task_dtl.tc_order_id = orders.tc_order_id
JOIN wm.do_status ON orders.do_status = do_status.order_status
JOIN wm.lpn ON task_dtl.carton_nbr = lpn.tc_lpn_id
JOIN wm.lpn_facility_status ON lpn.lpn_facility_status = lpn_facility_status.lpn_facility_status AND lpn_facility_status.inbound_outbound_indicator = 'O'
JOIN wm.wave_parm ON wm.wave_parm.wave_nbr = wm.task_dtl.TASK_GENRTN_REF_NBR
LEFT JOIN wm.task_dtl task_dtl_2 ON task_dtl_2.alloc_invn_dtl_id = alloc_invn_dtl.alloc_invn_dtl_id AND task_dtl_2.line_item_id = task_dtl.line_item_id AND task_dtl_2.task_cmpl_ref_code = '15'
LEFT JOIN wm.alloc_invn_dtl alloc_invn_dtl_2 ON alloc_invn_dtl_2.carton_nbr = task_dtl.carton_nbr AND task_dtl.carton_seq_nbr = alloc_invn_dtl_2.carton_seq_nbr AND alloc_invn_dtl_2.invn_need_type = 52
LEFT JOIN wm.picking_short_item ON task_dtl.line_item_id = picking_short_item.line_item_id AND task_dtl.tc_order_id = picking_short_item.tc_order_id
WHERE wm.orders.DO_STATUS IN (120,130,140,150,160,165,180)
AND wm.orders.order_type = 'ECOMM' 
-- AND wm.task_dtl.INVN_TYPE = 'E'
-- AND wm.task_dtl.CURR_WORK_GRP = 'SHLF'
